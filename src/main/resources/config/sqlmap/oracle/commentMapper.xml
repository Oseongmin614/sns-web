<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ac.kopo.sns.dao.CommentDAO">

    <resultMap id="commentMap" type="commentVO">
        <id property="commentId" column="COMMENT_ID"/>
        <result property="postId" column="POST_ID"/>
        <result property="userId" column="USER_ID"/>
        <result property="content" column="CONTENT"/>
        <result property="createdAt" column="CREATED_AT"/>
        <result property="isDeleted" column="IS_DELETED"/>
    </resultMap>

    <select id="selectCommentsByPostId" parameterType="long" resultMap="commentMap">
        SELECT * FROM COMMENTS WHERE POST_ID = #{postId} AND IS_DELETED = 'N' ORDER BY CREATED_AT ASC
    </select>

    <insert id="insertComment" parameterType="commentVO" useGeneratedKeys="true" keyProperty="commentId">
        INSERT INTO COMMENTS (COMMENT_ID, POST_ID, USER_ID, CONTENT, CREATED_AT, IS_DELETED)
        VALUES (SEQ_COMMENT_ID.NEXTVAL, #{postId}, #{userId}, #{content}, SYSDATE, 'N')
    </insert>

    <update id="updateComment" parameterType="commentVO">
        UPDATE COMMENTS
        SET CONTENT = #{content}
        WHERE COMMENT_ID = #{commentId}
    </update>

    <delete id="deleteComment" parameterType="long">
        UPDATE COMMENTS SET IS_DELETED = 'Y' WHERE COMMENT_ID = #{commentId}
    </delete>

</mapper>
